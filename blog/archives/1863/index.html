
<!DOCTYPE html>
<html lang="ja">
<head>

  
  <meta charset="UTF-8">
  <title>
    実機でonePKを使う | Aimless
  </title>


  
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1">


  
  <link rel="stylesheet" href="/css/sanitize.css">
  <link rel="stylesheet" href="/css/responsive.css">
  <link rel="stylesheet" href="/css/highlight_monokai.css">
  <link rel="stylesheet" href="/css/theme.css">
  <link rel="stylesheet" href="/css/custom.css">


  
  <script src="/js/less.js" type="text/javascript"></script>

  
<link href="/feed" rel="alternate" type="application/rss+xml" title="RSSフィード">

</head>



<body>
<div class="container">

  
  <header role="banner">
    <div class="row gutters">
      <div id="site-title" class="col span_6">
        <h1><a href="/blog/">Aimless</a></h1>
        <h2>Powered by aimless emotion</h2>
      </div>
      <div id="social" class="col span_6">
        <ul>
          <li><a href="https://twitter.com/kongou_ae" target="_blank">Twitter</a></li>
          
          <li><a href="https://github.com/kongou-ae" target="_blank">GitHub</a></li>
        </ul>
      </div>
    </div>
  </header>


  
  <main id="single" role="main">
    <div class="article-header">
      <h1>実機でonePKを使う</h1>
      <div class="meta">
        Apr 8, 2014 &nbsp;
        
          #<a href="/blog/categories/cisco">cisco</a>&nbsp;
        
          #<a href="/blog/categories/python">python</a>&nbsp;
        
      </div>
    </div>
    <article>
      

<p>いつまでもAll-in-oneVMだと面白くないので、自宅のcisco892JでもonepKでアクセスできるようにしました。乗り越えた課題は以下の二つです。</p>

<ol>
<li>onePKのバージョンを合わせる</li>
<li>認証</li>
</ol>

<h2 id="onepkのバージョン:121230cfe88f8075c75727c1b3ea9e45">onePKのバージョン</h2>

<p>　自宅のCisco892J：IOS 15.3(2)Tに対してonePKで書いたアプリを試してみたのですが、ONEP_BASE-3-VERSION_ERR:のエラーが出て接続できませんでした。ルータに出力されたログを見ると、IOSのバージョンが0.7.0、SDKのバージョンが1.2.0であることが原因のようです。</p>

<p>　</p>

<p>　現時点で最新の15.4(2)Tにアップデートしたところ、onePKのバージョンが1.2.0になりました。契約していてよかったSMARTnet。課題ひとつ解決。</p>

<h2 id="認証:121230cfe88f8075c75727c1b3ea9e45">認証</h2>

<p>　次は認証です。TLS認証は自己署名証明書と認証局の二択ですが、スタートガイドの注意点（<a href="https://developer.cisco.com/media/onepk_getting_started_guide/GUID-03D9D7BB-B201-45FD-B0DE-B928C9D70692.html">Using a Cisco Router with a Self-Signed Certificate</a>）を踏まえて、認証局（ただしオレオレ）を立てることにしました。</p>

<blockquote>
<p>Note: Self-signed certificates are appropriate for application development and testing in small deployments. For additional security, as well as more granular controls over individual certificate use and revocation, you should use certificates generated by your organization&#8217;s Certificate Authority. See Using a Cisco Router with a Certificate Authority. Additionally you should never use pinned certificates in a production environment.</p>
</blockquote>

<p>　ルータの認証はID/Pass認証とクライアント証明書の二択（<a href="https://developer.cisco.com/media/onepk_getting_started_guide/GUID-354FCB46-EA02-4315-8681-583C177357F4.html">Configuring onePK Application Authentication</a>）です。現時点ではID/Passにします。</p>

<p>　作業の大まかな流れは以下の通りです。</p>

<ol>
<li>オレオレ認証局を立てる。</li>
<li>ルータでCSRを発行する。</li>
<li>認証局で、CSRを利用して証明書を発行する。</li>
<li>ルータにオレオレルート証明書とオレオレサーバ証明書をインポートする。</li>
<li>アプリケーションが稼働するサーバにオレオレルート証明書を読み込む。</li>
</ol>

<p>　オレオレ認証局の設定は、<a href="http://l-w-i.net/t/openssl/cert_001.txt">プライベート認証局(CA)を構築して証明書の発行を行なう</a>が参考になります。</p>

<p>　Ciscoルータ側の設定は、<a href="http://www.cisco.com/cisco/web/support/JP/100/1004/1004783_sslm-csr.html">コピー アンド ペーストによる SSL サービス モジュールでの証明書署名要求の作成</a>と[PKI の証明書登録の設定][5]が参考になります。ルータへのオレオレRoot証明書とオレオレサーバ証明書のインストールは、コピーアンドペースト方式でやりました。</p>

<p>[5]: <a href="http://www.cisco.com/cisco/web/support/JP/docs/CIAN/IOS/IOS15_1M_T/CG/002/sec_cert_enroll_pki.html">http://www.cisco.com/cisco/web/support/JP/docs/CIAN/IOS/IOS15_1M_T/CG/002/sec_cert_enroll_pki.html</a></p>

    </article>
    <div class="ad-left">
    <iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=kongou00-22&o=9&p=12&l=bn1&mode=books-jp&browse=466298&fc1=000000&lt1=_blank&lc1=3366FF&bg1=FFFFFF&f=ifr" marginwidth="0" marginheight="0" width="300" height="250" border="0" frameborder="0" style="border:none;" scrolling="no"></iframe>

</div>
<div class="ad-right">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    <ins class="adsbygoogle"
         style="display:inline-block;width:336px;height:280px"
         data-ad-client="ca-pub-6172178439361228"
         data-ad-slot="8988676513"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
 <aside><div id="disqus_thread"></div></aside> 

<script type="text/javascript">
     
    var disqus_shortname = 'aimlessjpblog';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  </main>


  
  <footer role="contentinfo">
    <div style="text-align:center;">
      
      Written by kongou_ae
    </div>
  </footer>


</div>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-1736780-2', 'auto');
	ga('send', 'pageview');
</script>

</body>
</html>

