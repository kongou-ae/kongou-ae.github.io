<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Blogs on Aimless</title>
    <link>http://aimless.jp/blog/</link>
    <description>Recent content in Blogs on Aimless</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Wed, 25 Nov 2015 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://aimless.jp/blog/feed/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>CircleCIでRedPenを動かす</title>
      <link>http://aimless.jp/blog/archives/2686</link>
      <pubDate>Wed, 25 Nov 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2686</guid>
      <description>

&lt;h2 id=&#34;はじめに:fdefdb4df80f925e79defa0315e73418&#34;&gt;はじめに&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://aimless.jp/blog/archives/2685/&#34;&gt;RedPenにスペルチェック機能を追加する&lt;/a&gt;の続きです。CircleCI上でRedpenを動かしてみました。
&amp;gt; RedPenを利用したスペルチェックがローカル環境で動くことを確認しました。JavaScriptでチェック項目を拡張できるのがいいですね。次はスペルチェック用辞書の単語を増やした上で、CircleCI上で動作させてみようと思います。&lt;/p&gt;

&lt;h2 id=&#34;コンテナの仕込み:fdefdb4df80f925e79defa0315e73418&#34;&gt;コンテナの仕込み&lt;/h2&gt;

&lt;p&gt;CircleCIのコンテナでRedPenを動かさなければなりません。RedPenはJava 1.8が必要なのでcircle.ymの&lt;code&gt;machine&lt;/code&gt;の箇所に追加します。また、RedPenそのものをダウンロードしなければなりませんので、&lt;code&gt;dependencies&lt;/code&gt;の箇所でアーカイブのダウンロードと展開、削除を行います。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-circle.yml&#34;&gt;machine:
  timezone: Asia/Tokyo
  java:
    version: oraclejdk8

dependencies:
  pre:
    - wget https://github.com/redpen-cc/redpen/releases/download/v1.4.1/redpen-1.4.1.tar.gz
    - tar xvf redpen-1.4.1.tar.gz
    - rm redpen-1.4.1.tar.gz
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;テストの仕込み:fdefdb4df80f925e79defa0315e73418&#34;&gt;テストの仕込み&lt;/h2&gt;

&lt;p&gt;RedPenで独自Javascriptを利用するためには、設定ファイルとJavascriptファイルが必要です。せっかくなので、これらもリポジトリで管理します。ブログ用リポジトリにRedpenの設定ファイルとスペルチェック用Javascriptを配置します。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/20151125-01.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;circle.yml上で「直近の変更が.mdファイルの時だけテストを実行する」という書き方がわからなかったので、circle.ymlでは「直近の変更が.mdファイルの時だけテストを実行する」というスクリプトを実行することにしました。&lt;/p&gt;

&lt;p&gt;今回は以下のテストスクリプトを利用します。主に2つの作業を行っています。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ブログ用リポジトリからダウンロードしたRedPenの設定ファイルと独自Javascriptを、RedPen指定のディレクトリに移動する&lt;/li&gt;
&lt;li&gt;&lt;code&gt;git diff&lt;/code&gt;で直近の変更の差分からファイル名のみ取得し、そのファイル名が.mdであればRedPenによるテストを実行するスクリプトです。&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;#!/bin/sh
mv redpen/blog.xml redpen-*/conf
mv redpen/spellCheck.js redpen-*/js

filename=`git diff HEAD^ HEAD --name-only`

if [[ $filename =~ .*\.md$ ]] ;then
    echo &amp;quot;start to test $filename....&amp;quot;
    redpen-*/bin/redpen -c redpen-*/conf/blog.xml -f markdown $filename
else
    echo &amp;quot;$filename is not markdown. The test will not be performed.&amp;quot;
fi
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;実行:fdefdb4df80f925e79defa0315e73418&#34;&gt;実行&lt;/h3&gt;

&lt;p&gt;試してみましょう。書きかけのこのエントリーをブログ用リポジトリにプッシュしてみます。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>RedPenにスペルチェック機能を追加する</title>
      <link>http://aimless.jp/blog/archives/2685</link>
      <pubDate>Mon, 23 Nov 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2685</guid>
      <description>

&lt;h2 id=&#34;前置き:6a8429973c6a1dee2b4aa041f6e841a8&#34;&gt;前置き&lt;/h2&gt;

&lt;p&gt;もともとこのブログはWordpressで運用していました。ですが、アウトプットすることが目的であってCMSを運用することは目的ではありませんので、HUGO + Github Pagesの構成に切り替えました。&lt;/p&gt;

&lt;p&gt;切り替えに伴い、ブログ用のGithubリポジトリにMarkdownをPushすると、CircleCIがHUGOを使ってブログをビルドし、HTMLをGithub PagesにPushする、という仕組みにしました。&lt;/p&gt;

&lt;h2 id=&#34;文章をテストする:6a8429973c6a1dee2b4aa041f6e841a8&#34;&gt;文章をテストする&lt;/h2&gt;

&lt;p&gt;ブログを公開するプロセスにCircleCIがいますので、ブログの文章に対してCIを行うことがでいます。何をするか考えた結果、文章をテストすることにしました。ブログ用のGithubリポジトリにPushされたMarkdownをCircleCIでテストし、誤記や文法の誤りなどがあればテスト失敗とみなしビルドを行わない。こうすることで、ブログに誤った情報を含むエントリーが乗ってしまう可能性を減らすことができます。&lt;/p&gt;

&lt;p&gt;文章をテストするツールを探してみると、&lt;a href=&#34;https://github.com/textlint/textlint&#34;&gt;textlint/textlint&lt;/a&gt;と&lt;a href=&#34;https://github.com/redpen-cc/redpen/&#34;&gt;redpen-cc/redpen&lt;/a&gt;が見つかりました。asciidocとasciidocter-pdfを利用した気軽なドキュメント作成を模索していることもありますので、今回はasciidocをサポートするRedPenを使うことにします。&lt;/p&gt;

&lt;h2 id=&#34;実践:6a8429973c6a1dee2b4aa041f6e841a8&#34;&gt;実践&lt;/h2&gt;

&lt;p&gt;UTM製品であるフォーティゲートの正しいスペルは「FortiGate」です。FortigateやFroutigateではありません。ネットワークエンジニアとして、ネットワーク機器のスペルを間違えるのは恥ずかしい。そこでRedPenに、自分が指定するキーワードを利用したスペルチェック機能を実装します。&lt;/p&gt;

&lt;p&gt;RedPenはJavaScriptを利用した機能拡張をサポートしています。「&lt;a href=&#34;http://www.clear-code.com/blog/2015/8/29.html&#34;&gt;RedPenのValidatorをJavaScript で書くには&lt;/a&gt;」を参考に、JavaScriptによる機能拡張を実装します。&lt;/p&gt;

&lt;p&gt;スペルチェックについては編集距離を利用します。編集距離を求める関数は「&lt;a href=&#34;http://lostlinksearch.net/blog/2012/12/javascript%E3%81%A7%E7%B7%A8%E9%9B%86%E8%B7%9D%E9%9B%A2%EF%BC%88%E3%83%AC%E3%83%BC%E3%83%99%E3%83%B3%E3%82%B7%E3%83%A5%E3%82%BF%E3%82%A4%E3%83%B3%E8%B7%9D%E9%9B%A2%EF%BC%89%E3%82%92%E8%A8%88%E7%AE%97/&#34;&gt;JavaScriptで編集距離（レーベンシュタイン距離）を計算する&lt;/a&gt;
」をそのまま使わせていただきます。&lt;/p&gt;

&lt;p&gt;以下コードの通り、RedPenが検知した名詞とスペルチェックの確認対象との編集距離を求め、0ではなく3以下であればスペルミスとみなします。編集距離を３としたのは勢いです。適当な値はこれから模索していきます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;function validateSentence(sentence) {

  var levenshteinDistance = function(a, b) {
    var matrix = new Array(a.length + 1);
    for (var i = 0; i &amp;lt; a.length + 1; i++) {
      matrix[i] = new Array(b.length + 1);
    }

    for (var i = 0; i &amp;lt; a.length + 1; i++) {
      matrix[i][0] = i;
    }

    for (var j = 0; j &amp;lt; b.length + 1; j++) {
      matrix[0][j] = j;
    }

    for (var i = 1; i &amp;lt; a.length + 1; i++) {
      for (var j = 1; j &amp;lt; b.length + 1; j++) {
        var x = a[i - 1] == b[j -1] ? 0 : 1;
        matrix[i][j] = Math.min(
          matrix[i - 1][j] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j- 1] + x
        );
      }
    }

    return matrix[a.length][b.length];
  }


  console = {
      log: print,
      warn: print,
      error: print
  };

  var checkKeywordArray = [
    &#39;FortiGate&#39;,
    &#39;メルセデスベンツ&#39;,
    &#39;BIG-IP&#39;,
    &#39;インデックス&#39;,
    &#39;JavaScript&#39;
  ]

  for (var i = 0; i &amp;lt; sentence.tokens.length; i++) {
    // 名詞だけを対象に
    if (sentence.tokens[i].tags[0] == &#39;名詞&#39;) {
      for (var j=0; j &amp;lt; checkKeywordArray.length; j++) {
        //console.log(&#39;checking : &#39; + sentence.tokens[i].surface + &#39; and &#39; + checkKeywordArray[j])
        var dist = levenshteinDistance(sentence.tokens[i].surface,checkKeywordArray[j])        
        //console.log(sentence.tokens[i].surface +&#39; is &#39; + dist)
        if (dist &amp;lt;= 3 &amp;amp;&amp;amp; dist != 0){
          addError(sentence.tokens[i].surface + &#39;はスペルミスの可能性があります&#39;, sentence);
        }
      }
    }  
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;JavaScriptを利用したvalidatorをRedPenのコンフィグで有効にします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ cat conf/redpen-conf-ja-custom.xml                                   
&amp;lt;redpen-conf lang=&amp;quot;ja&amp;quot;&amp;gt;
    &amp;lt;validators&amp;gt;
        &amp;lt;validator name=&amp;quot;SentenceLength&amp;quot;&amp;gt;
            &amp;lt;property name=&amp;quot;max_len&amp;quot; value=&amp;quot;100&amp;quot;/&amp;gt;
        &amp;lt;/validator&amp;gt;
        &amp;lt;validator name=&amp;quot;KatakanaEndHyphen&amp;quot;/&amp;gt;
        &amp;lt;validator name=&amp;quot;SectionLength&amp;quot;&amp;gt;
            &amp;lt;property name=&amp;quot;max_num&amp;quot; value=&amp;quot;1500&amp;quot;/&amp;gt;
        &amp;lt;/validator&amp;gt;
        &amp;lt;validator name=&amp;quot;ParagraphNumber&amp;quot;/&amp;gt;
        &amp;lt;validator name=&amp;quot;SuccessiveWord&amp;quot; /&amp;gt;
        &amp;lt;validator name=&amp;quot;JavaScript&amp;quot; /&amp;gt;　　
    &amp;lt;/validators&amp;gt;
&amp;lt;/redpen-conf&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;テストするMarkdownは以下の通りです。あえて誤記をまぜます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ more test.md

## どうだー

インデックスは正しいです

インデデクスは間違っています

メルセデスベンスは間違っています

メルセデスベンツは正しいです

FortiGateは正しいです

Fortigateは間違っています

Frotigateも間違っています
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;テストします。間違ったスペルのセンテンスだけをエラーとして検知していますね。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;redpen-distribution-1.4.1]$ bin/redpen -c conf/redpen-conf-ja-custom.xml -f markdown test.md
[2015-11-23 18:55:02.902][INFO ] cc.redpen.Main - Configuration file: /home/aimless/study/document/redpen/redpen-distribution-1.4.1/conf/redpen-conf-ja-custom.xml
[2015-11-23 18:55:02.910][INFO ] cc.redpen.ConfigurationLoader - Loading config from specified config file: &amp;quot;/home/aimless/study/document/redpen/redpen-distribution-1.4.1/conf/redpen-conf-ja-custom.xml&amp;quot;
[2015-11-23 18:55:02.921][INFO ] cc.redpen.ConfigurationLoader - Succeeded to load configuration file
[2015-11-23 18:55:02.921][INFO ] cc.redpen.ConfigurationLoader - Language is set to &amp;quot;ja&amp;quot;
[2015-11-23 18:55:02.921][WARN ] cc.redpen.ConfigurationLoader - No type configuration...
[2015-11-23 18:55:02.922][INFO ] cc.redpen.ConfigurationLoader - No &amp;quot;symbols&amp;quot; block found in the configuration
[2015-11-23 18:55:02.990][INFO ] cc.redpen.config.SymbolTable - &amp;quot;ja&amp;quot; is specified.
[2015-11-23 18:55:02.990][INFO ] cc.redpen.config.SymbolTable - &amp;quot;normal&amp;quot; type is specified
[2015-11-23 18:55:03.497][INFO ] cc.redpen.parser.SentenceExtractor - &amp;quot;[。, ？, ！]&amp;quot; are added as a end of sentence characters
[2015-11-23 18:55:03.498][INFO ] cc.redpen.parser.SentenceExtractor - &amp;quot;[’, ”]&amp;quot; are added as a right quotation characters
[2015-11-23 18:55:03.512][INFO ] cc.redpen.validator.Validator - max_len is set to 100
[2015-11-23 18:55:03.515][INFO ] cc.redpen.validator.Validator - max_num is set to 1500
[2015-11-23 18:55:03.516][INFO ] cc.redpen.validator.Validator - max_num is not set. Use default value of 5
[2015-11-23 18:55:03.519][INFO ] cc.redpen.validator.JavaScriptValidator - JavaScript validators directory: /home/aimless/study/document/redpen/redpen-distribution-1.4.1/js
test.md:1: ValidationError[ParagraphNumber], The number of paragraphs exceeds the maximum of 7. at line: どうだー
test.md:5: ValidationError[JavaScript], [spellcheck.js] インデデクスはスペルミスの可能性があります at line: インデデクスは間違っています
test.md:7: ValidationError[JavaScript], [spellcheck.js] メルセデスベンスはスペルミスの可能性があります at line: メルセデスベンスは間違っています
test.md:13: ValidationError[JavaScript], [spellcheck.js] Fortigateはスペルミスの可能性があります at line: Fortigateは間違っています
test.md:15: ValidationError[JavaScript], [spellcheck.js] Frotigateはスペルミスの可能性があります at line: Frotigateも間違っています

[2015-11-23 18:55:04.483][ERROR] cc.redpen.Main - The number of errors &amp;quot;5&amp;quot; is larger than specified (limit is &amp;quot;1&amp;quot;).
[aimless@dev redpen-distribution-1.4.1]$
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;所感:6a8429973c6a1dee2b4aa041f6e841a8&#34;&gt;所感&lt;/h2&gt;

&lt;p&gt;RedPenを利用したスペルチェックがローカル環境で動くことを確認しました。JavaScriptでチェック項目を拡張できるのがいいですね。次はスペルチェック用辞書の単語を増やした上で、CircleCI上で動作させてみようと思います。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>aws2excelを作ってみた</title>
      <link>http://aimless.jp/blog/archives/2684</link>
      <pubDate>Sun, 15 Nov 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2684</guid>
      <description>

&lt;h2 id=&#34;作ったもの:d4fd824ade6bd5facb61487e58730a29&#34;&gt;作ったもの&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kongou-ae/aws2excel&#34;&gt;kongou-ae/aws2excel&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AWSの構成情報をxlsxファイルに書き出すスクリプトです。出力されるファイルのイメージはREADMEの画像を参照ください。勢いでやっつけているので、一部サービスにのみ対応しています。最終的にはLambdaで動かしてs3にExcelを吐き出す実装にしたい。&lt;/p&gt;

&lt;h2 id=&#34;経緯:d4fd824ade6bd5facb61487e58730a29&#34;&gt;経緯&lt;/h2&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;en&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/ishikawa84g&#34;&gt;@ishikawa84g&lt;/a&gt; cloud2excel!&lt;/p&gt;&amp;mdash; 前佛 雅人(M.Zembutsu) (@zembutsu) &lt;a href=&#34;https://twitter.com/zembutsu/status/660383609283457024&#34;&gt;2015, 10月 31&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/ishikawa84g&#34;&gt;@ishikawa84g&lt;/a&gt; 残念ながら夢の中のお話です…&lt;/p&gt;&amp;mdash; 前佛 雅人(M.Zembutsu) (@zembutsu) &lt;a href=&#34;https://twitter.com/zembutsu/status/660384559700176896&#34;&gt;2015, 10月 31&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/ishikawa84g&#34;&gt;@ishikawa84g&lt;/a&gt; ごめんなさい…ごめんなさいｗ&lt;/p&gt;&amp;mdash; 前佛 雅人(M.Zembutsu) (@zembutsu) &lt;a href=&#34;https://twitter.com/zembutsu/status/660384991096868865&#34;&gt;2015, 10月 31&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;自分もワクワクしながらcloud2excelを検索しまして、、、無いのであれば、勉強がてら作ってみようということで作ってみました。&lt;/p&gt;

&lt;h2 id=&#34;実装:d4fd824ade6bd5facb61487e58730a29&#34;&gt;実装&lt;/h2&gt;

&lt;p&gt;aws-sdkを利用してAPIを叩き必要な情報を取得し、その情報をExcel に書き出しているだけです。Excelへの書き出しは&lt;a href=&#34;https://github.com/guyonroche/exceljs&#34;&gt;guyonroche/exceljs&lt;/a&gt;を使いました。&lt;/p&gt;

&lt;h2 id=&#34;雑感:d4fd824ade6bd5facb61487e58730a29&#34;&gt;雑感&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/guyonroche/exceljs&#34;&gt;guyonroche/exceljs&lt;/a&gt;を見つけたのが今回の最大の収穫です。配列やオブジェクトの情報を、かなり簡単に表形式でExcelに書き出すことができます。さらに、&lt;a href=&#34;https://github.com/guyonroche/exceljs&#34;&gt;guyonroche/exceljs&lt;/a&gt;は、Excelからの読み込みもできるようなので、Infrastrucrture as Excelが実現できます。Excelでパラメータシートを作り、そこにパラメータを書くとAWS上にインスタンスができる。なんという黒魔術。やりませんけど。。。&lt;/p&gt;

&lt;p&gt;また、Node.jsの非同期処理に苦戦しました。async.jsを使っており期待する動作はしているものの、正しい使い方かどうか不安です。Node.js（というかJavascript）を体系的に学びたい。&lt;/p&gt;

&lt;p&gt;今後は、issueにもある通り、コードを分割してメンテナンス性を高め、ELBやRDSなどメジャーなサービスに対応しようと思います。仕事の本業はAWSではないので、プライベートで淡々とメンテしていきます。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>リーダーな私が意識している事</title>
      <link>http://aimless.jp/blog/archives/2683</link>
      <pubDate>Sat, 14 Nov 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2683</guid>
      <description>

&lt;p&gt;リーダと呼ばれるポジションに就き、5名のメンバーと一緒に仕事を行うこと3年、ふと「昔と比べると丸くなったなー」と思ったので、今意識している事をメモしておきます。社内研修や書籍、聖杯問答など、人を導くということについて色々な角度で学んだことを自分なりに消化した結果です。実際にできていることもあれば、中々できないこともあるので、今一度意識しなおして、半年くらい経ったら見返したい。&lt;/p&gt;

&lt;h2 id=&#34;信じて任せる:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;信じて任せる&lt;/h2&gt;

&lt;p&gt;大原則として、メンバーを信じることにしています。また、メンバーを信じているということを、心の中で思っているだけでなくメンバーの前で明言します。「信じてるよ」と。メンバーを信じでいますので、能動的に仕事を回しているメンバーに対しては、仕事の細部に口を出すことはしません。信じて任せます。&lt;/p&gt;

&lt;h2 id=&#34;放置しない:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;放置しない&lt;/h2&gt;

&lt;p&gt;信じると放置するは違うと考えています。リーダである私は、チームとして与えられたミッションをクリアすることで評価されます。そのためには、自分のメンバーが成果を出すことが必要不可欠です。チームに与えられているミッションは、自分の力だけで解決できる量をとうに超えています。従って、信じていると宣言する一方で、メンバーの成果が出ていることを確認し、必要に応じて軌道修正を行うことを意識しています。&lt;/p&gt;

&lt;p&gt;例えば、週次ミーティングでの進捗報告や、メーリングリストに流れるメンバーのメールでのやりとりで、メンバーのアウトプットの有無や質を確認し、期待する成果に届いていない場合は声をかけます。困っているようであれば自分の仕事を止めて助け、悩んでいるようであれば一緒に悩みます。すべての変更作業について、私の承認が必要なプロセスにしているのも、放置しないの一環です。信じているし任せますが、最終的な責任まで放棄する気はありません。&lt;/p&gt;

&lt;h2 id=&#34;メンバーに決めさせる:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;メンバーに決めさせる&lt;/h2&gt;

&lt;p&gt;リーダになった当初、リーダの仕事は決める事だと思っていましたが、何から何まで決めるのは止めました。特に、メンバーのタスクであれば、メンバーに決めてもらうことにしています。決められないのであれば、メンバーの悩みや迷いを聴いた上で、整理した上で再提示し、解決へのヒントを与える。こんな地味な事を繰り返し、メンバーに決めてもらう事を意識しています。&lt;/p&gt;

&lt;p&gt;当然、自分でも決められますし、自分で決めて指示したほうが早いこともあります。ですが、メンバーが自分で決められることを私が決めるということは、メンバーの力を疑っているということだと思います。前述した信じるというポリシーにも反します。また、何から何まで自分が決めていると、自分がチームのボトルネックになってしまい、チームとして与えられたミッションを達成できなくなってしまいます。ですから、信じるメンバーに悩んでもらい決めてもらうことにしました。&lt;/p&gt;

&lt;p&gt;一方で、メンバーが悩んでどうしても決められない場合や、チームとしての決断が必要な場合は、即判断します。リーダですから。&lt;/p&gt;

&lt;h2 id=&#34;ほめる:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;ほめる&lt;/h2&gt;

&lt;p&gt;仕事だからやって当然という考えは捨てました。仕事はツライ。だからこそ、頑張ってくれたメンバーはしっかり褒める。メールだけでなく、言葉で、他のメンバーのいる場で褒めます。「さすが」「完璧」といった簡易な言葉でも構わないので、ほめることを意識しています。&lt;/p&gt;

&lt;p&gt;作業直前で手順の誤りに気がついた部下が相談に来たら、皆さんはどうしますか。「何やってんの、、」と怒りを示していませんか？私は褒めます。「作業する前に気がついてよかったじゃん。よく気がついたよ。ありがとね」と。怒っても仕方ない。&lt;/p&gt;

&lt;h2 id=&#34;感情を表に出す:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;感情を表に出す&lt;/h2&gt;

&lt;p&gt;あえて感情を表に出すことにしています。私が人間臭い人が好きだからです。ただし、自分の負の感情は除く。負の感情はメンバーのいないところで発散します。&lt;/p&gt;

&lt;p&gt;成果を出してくれたメンバーには、その成果を一緒に喜び、感謝します。メールだけでなく、言葉で。深夜作業や厳しい仕事を成し遂げたメンバーには、「無事終わってうれしい。ありがとう」と喜びと感謝を。&lt;/p&gt;

&lt;p&gt;チーム外から理不尽な扱いを受けているメンバーがいれば、その怒りは私が代わりに声を上げることにしています。仕事だからといって理不尽が許されるわけではない。そうはいってもメンバーは言いにくいでしょうから、私が代わりに怒りの声を上げることで、メンバーの気持ちを少しでも軽くできればと思ってやっています。&lt;/p&gt;

&lt;p&gt;しょうもない雑談と笑いも大事にしています。仕事の合間の雑談、楽しいでしょ。こういうの大事。&lt;/p&gt;

&lt;h2 id=&#34;やり方ではなくゴールを指示する:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;やり方ではなくゴールを指示する&lt;/h2&gt;

&lt;p&gt;仕事の細かいやり方を指示することはやめました。やり方はメンバーでも考えられるのですから（むしろメンバーの方が詳細に考えらえる事の方が多い）、やり方ではなく、私が期待する成果のあり姿を明確に伝える事を意識しています。「この仕事をお願いします。こーやって、あーやって、こうやってください」ではなく「この仕事をお願いします。成果物はこんなイメージ」であったり「この仕事をお願いします。○○できるようにするのがゴール」といったイメージです。&lt;/p&gt;

&lt;h2 id=&#34;門戸を開く:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;門戸を開く&lt;/h2&gt;

&lt;p&gt;「何かあったら相談してね」「出かけるけど、何かあったら携帯ならしてね」は口癖になりました。明言することで、相談や緊急時の連絡が増えたような気がしています。相談や緊急連絡が増えると自分の仕事は止まりますが、リーダというものは、こういうものだと割り切ることにしました。チームとして成果が出ればいいよ。ゆえに、リーダ以外の業務は、メンバーが退社した17時以降が本番です。&lt;/p&gt;

&lt;h2 id=&#34;チームである事を口にし続ける:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;チームである事を口にし続ける&lt;/h2&gt;

&lt;p&gt;自分とメンバーの事を「○○チーム」と呼ぶことを意識しています。私たちは個ではなくチームであること、つまり仲間であることを自分とメンバーに意識づけられればと思ってあえて言い続けています。最大の効果は、自分がチームのリーダであることを常に自分に意識づけし続けられることかもしれません。&lt;/p&gt;

&lt;h2 id=&#34;最後に:cfff3a3a77bc1035e507c0bd778c73d2&#34;&gt;最後に&lt;/h2&gt;

&lt;p&gt;　リーダーって何なんだろうなー。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Amazon LinuxにZabbix3.0をインストールしてハマった事</title>
      <link>http://aimless.jp/blog/archives/2682</link>
      <pubDate>Mon, 26 Oct 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2682</guid>
      <description>

&lt;p&gt;Zabbix3.0（アルファ版）のソースが公開されていたので、Amazon Linuxにインストールを試みました。その際にはまったことをメモしておきます。ハマったといっても、マニュアルのRequirementsを読んでからインストールを始めれば、全くハマらないポイントです。。。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.zabbix.com/documentation/3.0/&#34;&gt;Zabbix Documentation 3.0&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Amazon Linuxのバージョン：2015.09&lt;/li&gt;
&lt;li&gt;Zabbixのバージョン：3.0.0 alpha3&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;サポートするphpのバージョンが5-4-0以上である:36b14705263dd1ce094510eba4cf7e4c&#34;&gt;サポートするPHPのバージョンが5.4.0以上である&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/2015-10-26-001.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　Amazon Linuxで何も考えずに&lt;code&gt;sudo yum install php php-gd php-bcmath php-mysql php-mbstring&lt;/code&gt;すると、インストールされるPHPのバージョンは5.3になります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;============================================================================================================================
 Package                       Arch                    Version                             Repository                  Size
============================================================================================================================
Installing:
 php                           x86_64                  5.3.29-1.8.amzn1                    amzn-main                  2.8 M
 php-bcmath                    x86_64                  5.3.29-1.8.amzn1                    amzn-main                   52 k
 php-gd                        x86_64                  5.3.29-1.8.amzn1                    amzn-main                  219 k
 php-mbstring                  x86_64                  5.3.29-1.8.amzn1                    amzn-main                  2.3 M
 php-mysql                     x86_64                  5.3.29-1.8.amzn1                    amzn-main                  178 k
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　Zabbix3.0は、php5.3をサポートしていません。php5.4以上をサポートしています。&lt;code&gt;sudo yum install php54 php54-gd php54-bcmath php54-mysql php54-mbstring&lt;/code&gt;でphp5.4をインストールするようにしましょう。&lt;/p&gt;

&lt;h2 id=&#34;php5-4がapache2-4系に依存している:36b14705263dd1ce094510eba4cf7e4c&#34;&gt;php5.4がapache2.4系に依存している&lt;/h2&gt;

&lt;p&gt;　apache2.2がインストールされている場合、php5.3をyum removeし、いざphp5.4系をyum installしようとしても、依存エラーになります。&lt;/p&gt;

&lt;p&gt;　これはphp5.4がapache2.4に依存しているためです。php5.4が必要とするapache2.4が、元々入っているapache2.2と競合してしまうためにエラーとなります。apache2.2系のパッケージを削除してからphp54のインストールを行いましょう。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ sudo yum install php54 php54-gd php54-bcmath php54-mysql php54-mbstring
Loaded plugins: priorities, update-motd, upgrade-helper
Resolving Dependencies
--&amp;gt; Running transaction check
---&amp;gt; Package php54.x86_64 0:5.4.45-1.75.amzn1 will be installed
--&amp;gt; Processing Dependency: httpd-mmn = 20120211x86-64 for package: php54-5.4.45-1.75.amzn1.x86_64
--&amp;gt; Processing Dependency: php54-common(x86-64) = 5.4.45-1.75.amzn1 for package: php54-5.4.45-1.75.amzn1.x86_64
--&amp;gt; Processing Dependency: php54-cli(x86-64) = 5.4.45-1.75.amzn1 for package: php54-5.4.45-1.75.amzn1.x86_64
--&amp;gt; Processing Dependency: httpd24 for package: php54-5.4.45-1.75.amzn1.x86_64
（中略）
--&amp;gt; Finished Dependency Resolution
Error: httpd24-tools conflicts with httpd-tools-2.2.31-1.6.amzn1.x86_64
Error: httpd24 conflicts with httpd-2.2.31-1.6.amzn1.x86_64
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Lambdaファンクションを雑に監視する</title>
      <link>http://aimless.jp/blog/archives/2681</link>
      <pubDate>Sun, 25 Oct 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2681</guid>
      <description>

&lt;h2 id=&#34;lambdaへの切り替え:6d0ff38d6f824570d13427bb9cb52ec6&#34;&gt;Lambdaへの切り替え&lt;/h2&gt;

&lt;p&gt;　Lambdaがスケジュール実行に対応しました。そこで、サーバレスアーキテクチャを実践すべく、conohaで動いている＠ipv6kumaの機能を、AWSに順次お引越ししています。本日時点で、以下のフルルート数とフルルートグラフのツイートはLambdaでお伝えしています。&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;2015/10/25の経路数は24457だクマー。昨日と比べて35経路増えたクマ！！ /from Lambda&lt;/p&gt;&amp;mdash; ブイロクマ (@IPv6kuma) &lt;a href=&#34;https://twitter.com/IPv6kuma/status/658221773335334912&#34;&gt;2015, 10月 25&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;本日までの経路数をグラフにしたクマ!! &lt;a href=&#34;https://t.co/Z9jHt6yXnT&#34;&gt;https://t.co/Z9jHt6yXnT&lt;/a&gt;&lt;/p&gt;&amp;mdash; ブイロクマ (@IPv6kuma) &lt;a href=&#34;https://twitter.com/IPv6kuma/status/658221776074244097&#34;&gt;2015, 10月 25&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h2 id=&#34;lambdaを監視する:6d0ff38d6f824570d13427bb9cb52ec6&#34;&gt;Lambdaを監視する&lt;/h2&gt;

&lt;p&gt;　さて、Lambdaファンクションを書いていて気になった事があります。それは『Lambdaファンクションが正しく動作している事をどうやって監視するか』です。&lt;/p&gt;

&lt;p&gt;　現時点での＠ipv6kumaは、エラーハンドリングを書いていません。想定通りに動作した最後の箇所に&lt;code&gt;context.done()&lt;/code&gt;を記載しているだけです。したがって、エラーが起きると&lt;code&gt;context.done()&lt;/code&gt;が呼び出されないので、ログには必ず&lt;code&gt;Process exited before completing request&lt;/code&gt;が出現します。&lt;/p&gt;

&lt;p&gt;　そこで、この文言をcloudwatch logsのMetric Filterを利用して監視することで、Lambdaファンクションが想定通りに動いているかどうかを監視することにしました。&lt;/p&gt;

&lt;h2 id=&#34;設定方法:6d0ff38d6f824570d13427bb9cb52ec6&#34;&gt;設定方法&lt;/h2&gt;

&lt;p&gt;　監視したいログを選択し、&lt;code&gt;Create Metric Filter&lt;/code&gt;を選択。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/2015-10-25-00.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　&lt;code&gt;Filter Pattern&lt;/code&gt;に&lt;code&gt;Process exited before completing request&lt;/code&gt;を入力して次に進む&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/2015-10-25-01.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　&lt;code&gt;Metric Name&lt;/code&gt;の欄に、カスタムメトリック名を入力し&lt;code&gt;Save Filter&lt;/code&gt;を押下&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/2015-10-25-02.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　メトリックフィルターができました。このフィルターに紐づくアラームを作成します。&lt;code&gt;Create Alarm&lt;/code&gt;を押下&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/2015-10-25-03.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　必要なパラメータを入力します。Metric Filter作成時にMetricを1にしましたので、アラームの閾値は1以上とします。ActionにSNSを通知することで、エラーの発生をメールで通知します。ipv6kuma_errorのサブスクライバーは私の個人アドレスになっています。&lt;/p&gt;

&lt;p&gt;　最後に&lt;code&gt;Create Alarm&lt;/code&gt;を押下&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/2015-10-25-04.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　アラームつきのMetric Filterができました！&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/2015-10-25-05.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;動作確認:6d0ff38d6f824570d13427bb9cb52ec6&#34;&gt;動作確認&lt;/h2&gt;

&lt;p&gt;　@ipv6kumaはエラーを起こすのが大変なので、別のLambdaファンクションに同様の監視を実装して、&lt;code&gt;Process exited before completing request&lt;/code&gt;を発生させました。&lt;/p&gt;

&lt;p&gt;　少々待つと、CloudwatchのエラーがSNS経由で通知されました。これで@ipv6kumaに何かあった場合、気が付くことができます。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/images/2015-10-25-06.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ソフトバンクショップでiPhone 6s Plusに機種変更したら、5137円/月のオプションが付いた</title>
      <link>http://aimless.jp/blog/archives/2680</link>
      <pubDate>Sun, 27 Sep 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2680</guid>
      <description>

&lt;p&gt;iPhone 6s Plusに機種変更しました。画面が大きいのはいいことです。&lt;/p&gt;

&lt;p&gt;　さて、&lt;a href=&#34;http://akimotoshoji.blog.jp/archives/51481475.html&#34;&gt;iPhone6sの機種変で、ソフトバンクに3500円/月のオプション加入を迫られたwww&lt;/a&gt;を見て、「そういえば私もかなりのオプションサービスに加入したなぁ」と思ったのでメモ。&lt;/p&gt;

&lt;h2 id=&#34;加入したオプション一覧:ce8ce68010b7d182bf86a7b0486be8f5&#34;&gt;加入したオプション一覧&lt;/h2&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;サービス名&lt;/th&gt;
&lt;th&gt;月額料金&lt;/th&gt;
&lt;th&gt;備考&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;あんしん保証パックプラス&lt;/td&gt;
&lt;td&gt;￥702&lt;/td&gt;
&lt;td&gt;機種変更前も契約。機種変更後も利用&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;基本パック&lt;/td&gt;
&lt;td&gt;￥540&lt;/td&gt;
&lt;td&gt;機種変更前も契約。機種変更後も利用&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;機種変更先取りプログラム&lt;/td&gt;
&lt;td&gt;￥324&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;オススメコンテンツ&lt;/td&gt;
&lt;td&gt;￥324&lt;/td&gt;
&lt;td&gt;ことりっぷ、ライフレンジャー、music.jpのパック&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;とく放題（m）&lt;/td&gt;
&lt;td&gt;￥637&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;UULA&lt;/td&gt;
&lt;td&gt;￥504&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;アニメ放題&lt;/td&gt;
&lt;td&gt;￥540&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;ブック放題&lt;/td&gt;
&lt;td&gt;￥540&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;NETFLIX&lt;/td&gt;
&lt;td&gt;￥1026&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;　さらに、速度維持の仕組みが「制限モード」から「快適モード」に変更になりました。「快適モード」だと、「3日で1Gバイト」の制限に引っかかった場合に、￥2500/2Gの権利が自動的に購入されます。つまり、この現代においてパケ死するモードです。&lt;/p&gt;

&lt;h2 id=&#34;対応:ce8ce68010b7d182bf86a7b0486be8f5&#34;&gt;対応&lt;/h2&gt;

&lt;p&gt;　契約時に不要なオプションがつくのは儀式だと思っているので、お店の方と「今日家に帰ってすぐに全部解約してもいいんですよね？」「お店としては10月1日以降だとありがたいのですが・・・」というやり取りをしたうえで、不要なオプションは全部解約＆速度維持を制限モードに変更しました。&lt;/p&gt;

&lt;p&gt;　解約の手続きをお客様センターのオペレータさんにお願いしようと思ったのですが、オペレータさんの対応時間が20時までであり、帰宅したのが20時を過ぎていたため、MySoftbankで手続きを行いました。大変でした。&lt;/p&gt;

&lt;p&gt;　唯一、NETFLIXだけが、解約手続きをしたはずなのに、My Softbankのオプションサービス一覧に居続けています。これは、NETFLIXの契約が請求期間の最終日にキャンセルになる関係だと信じたい。&lt;/p&gt;

&lt;h2 id=&#34;感想:ce8ce68010b7d182bf86a7b0486be8f5&#34;&gt;感想&lt;/h2&gt;

&lt;p&gt;　お店の方は「いらなければ全部変更してくださいね」「（説明資料をマーキングしたうえで）これを外してくださいね」ときちんと説明してくれました。また、説明資料にはオプションサービスの解約方法がしっかり書いてありました。そのため、いらいないサービスを押し付けられたにも関わらず、お店の印象は悪くないという不思議。気持ちよく儀式を終えることができました。&lt;/p&gt;

&lt;p&gt;　「100発撃てば1発はあたる」と思ってやっているんでしょうが、この儀式、いったい誰の指示なんでしょうね。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>API Gateway &#43; Lambdaを使って、マルチクラウド管理APIを作る</title>
      <link>http://aimless.jp/blog/archives/2679</link>
      <pubDate>Sat, 18 Jul 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2679</guid>
      <description>&lt;p&gt;「単一のREST APIで複数のクラウドを操作できたら便利だろうなー」と思い調べてみたところ、以下のようなライブラリを見つけました。&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;言語&lt;/th&gt;
&lt;th&gt;ライブラリ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Ruby&lt;/td&gt;
&lt;td&gt;DeltaCloud&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Python&lt;/td&gt;
&lt;td&gt;libcloud&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Node.js&lt;/td&gt;
&lt;td&gt;pkgcloud&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Golang&lt;/td&gt;
&lt;td&gt;Gophercloud&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;　ライブラリによってサポートするクラウドプロバイダーが異なり、さらに管理できるサービスと管理できないサービスがあります。どれか一つのライブラリと心中するのは、少々リスクだと思いました。&lt;/p&gt;

&lt;p&gt;　「何か他にいい方法はないかなー」と調べていたところに、Amazon API Gatewayがリリースされました。API Gatewayを利用すると、API Gateway経由でLambdaを実行することができます。LambdaではNode.jsとjavaが動きます。主要なクラウドにはNode.jsやjavaのSDKが存在します。つまり、API Gatewayを利用すれば、自分のやりたいことができる、マルチクラウド管理APIを作れそうな気がしました。&lt;/p&gt;

&lt;p&gt;　というわけで実践。AzureとAWSのインスタンス情報をまとめて返すAPIを作ってみます。&lt;/p&gt;

&lt;p&gt;　API Gatewayでは、/computeがGETされた場合にLambdaファンクションを発火するようにします。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/07/api_gateway_setting.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　そして、対応するLambdaファンクションでは以下のコードを動かします。SDKを利用して各クラウドのインスタンス情報を取得し配列に格納し、その配列を返すスクリプトです。&lt;/p&gt;

&lt;p&gt;　とりあえずということで、認証情報の扱いは適当です。AWSの認証情報はコード内にベタ書きします。Azureの証明書は、lambdaファンクションのZIPに含めます。実際のところは、API Gatewayにアクセスする際のHTTPヘッダに認証情報を含め、Lambdaファンクションに渡す方法がカッコいいと思います。&lt;/p&gt;

&lt;script src=&#34;https://gist.github.com/kongou-ae/ad0b1366da2ee5efbbaa.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;　ブラウザでAPI Gatewayの/computeにアクセスすると、以下のJSONが返ってきます。AzureとAWSのインスタンス情報が一つのJSONのレスポンスになっています。いい感じですね。このレスポンスをJavascriptでいい感じに表示するHTMLを作ってS3に配置すれば、サーバレスのマルチクラウド管理ポータルが作れるかも？&lt;/p&gt;

&lt;script src=&#34;https://gist.github.com/kongou-ae/825a49a087311e0814ad.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/07/result_of_api.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Rails4でRedmine CORSを使う</title>
      <link>http://aimless.jp/blog/archives/2669</link>
      <pubDate>Tue, 07 Jul 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2669</guid>
      <description>

&lt;h2 id=&#34;やりたいこと:273ca993f084584514ef76dff312aa4b&#34;&gt;やりたいこと&lt;/h2&gt;

&lt;p&gt;　Cross-Origin Resource SharingでRedmineのデータを取得する&lt;/p&gt;

&lt;h2 id=&#34;実現方法:273ca993f084584514ef76dff312aa4b&#34;&gt;実現方法&lt;/h2&gt;

&lt;p&gt;　[Redmine CORS][1]を使い、RedmineをCORSに対応させる&lt;/p&gt;

&lt;h2 id=&#34;やってみたこと:273ca993f084584514ef76dff312aa4b&#34;&gt;やってみたこと&lt;/h2&gt;

&lt;p&gt;　READMEに記載されている方法でやってみたところ、以下の環境では動作しませんでした。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Environment:
  Redmine version                3.1.0.devel
  Ruby version                   2.2.2-p95 (2015-04-13) [x86_64-linux]
  Rails version                  4.2.3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　具体的にはプラグインのマイグレーション時に以下のエラーメッセージが出ます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ mogok rake redmine:plugins:migrate                   
Running &amp;#039;rake redmine:plugins:migrate&amp;#039;...
2015-07-07T20:56:44+09:00 console[app3014.29]: An error occurred while loading the routes definition of redmine_cors plugin (/app/plugins/redmine_cors/config/routes.rb): You should not use the `match` method in your router without specifying an HTTP method.
2015-07-07T20:56:44+09:00 console[app3014.29]: If you want to expose your action to both GET and POST, add `via: [:get, :post]` option.
2015-07-07T20:56:44+09:00 console[app3014.29]: If you want to expose your action to GET, use `get` in the router:
2015-07-07T20:56:44+09:00 console[app3014.29]:   Instead of: match &#34;controller#action&#34;
2015-07-07T20:56:44+09:00 console[app3014.29]:   Do: get &#34;controller#action&#34;.
&lt;/code&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　エラーメッセージに言われるがまま、以下の箇所のmatchをgetにかえると、プラグインのマイグレーションは成功します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ more plugins/redmine_cors/config/routes.rb 
RedmineApp::Application.routes.draw do
  match &amp;#039;*path&amp;#039;, :to =&amp;gt; &amp;#039;cors#preflight&amp;#039;, :constraints =&amp;gt; {:method =&amp;gt; &amp;#039;OPTIONS&amp;#039;}
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　ただし、ルーティングがないというエラーメッセージが出て、結局動作しません。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2015-07-07T20:00:46+09:00 app[app3012.03]: ActionController::RoutingError (No route matches [OPTIONS] &#34;/users/current.json&#34;):
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/actionpack-4.2.3/lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/actionpack-4.2.3/lib/action_dispatch/middleware/show_exceptions.rb:30:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/railties-4.2.3/lib/rails/rack/logger.rb:38:in `call_app&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/railties-4.2.3/lib/rails/rack/logger.rb:20:in `block in call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/activesupport-4.2.3/lib/active_support/tagged_logging.rb:68:in `block in tagged&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/activesupport-4.2.3/lib/active_support/tagged_logging.rb:26:in `tagged&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/activesupport-4.2.3/lib/active_support/tagged_logging.rb:68:in `tagged&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/railties-4.2.3/lib/rails/rack/logger.rb:20:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/actionpack-4.2.3/lib/action_dispatch/middleware/request_id.rb:21:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/rack-1.6.4/lib/rack/methodoverride.rb:22:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/rack-1.6.4/lib/rack/runtime.rb:18:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/activesupport-4.2.3/lib/active_support/cache/strategy/local_cache_middleware.rb:28:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/actionpack-4.2.3/lib/action_dispatch/middleware/static.rb:116:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/rack-1.6.4/lib/rack/sendfile.rb:113:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/railties-4.2.3/lib/rails/engine.rb:518:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/railties-4.2.3/lib/rails/application.rb:165:in `call&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/railties-4.2.3/lib/rails/railtie.rb:194:in `public_send&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   .bundle/gems/ruby/2.2.0/gems/railties-4.2.3/lib/rails/railtie.rb:194:in `method_missing&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/connection.rb:86:in `block in pre_process&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/connection.rb:84:in `catch&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/connection.rb:84:in `pre_process&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/connection.rb:53:in `process&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/connection.rb:39:in `receive_data&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/eventmachine.rb:187:in `run_machine&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/eventmachine.rb:187:in `run&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/backends/base.rb:73:in `start&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/server.rb:162:in `start&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/controllers/controller.rb:87:in `start&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/runner.rb:199:in `run_command&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2.2-1/lib/ruby/site_ruby/2.2.0/thin/runner.rb:155:in `run!&amp;#039;
2015-07-07T20:00:46+09:00 app[app3012.03]:   /opt/ruby-2.2/bin/thin:6:in `&amp;lt;main&amp;gt;&amp;#039;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;対応策:273ca993f084584514ef76dff312aa4b&#34;&gt;対応策&lt;/h2&gt;

&lt;p&gt;　プラグインのroutes.rbを正しく書き換えます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ more plugins/redmine_cors/config/routes.rb 
RedmineApp::Application.routes.draw do
  match &amp;#039;*path&amp;#039;, :to =&amp;gt; &amp;#039;cors#preflight&amp;#039;, via: :options
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　なお、書き換えた後に気が付いたのですが、Redmine CORSをRedmine3.0で動作させるためのプルリクエストが出てますね。。。&lt;/p&gt;

&lt;p&gt;[1]: &lt;a href=&#34;https://github.com/mavimo/redmine_cors&#34;&gt;https://github.com/mavimo/redmine_cors&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>asciidocをPDFに変換してみた（asciidoctor-pdf）</title>
      <link>http://aimless.jp/blog/archives/2641</link>
      <pubDate>Wed, 01 Jul 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2641</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://aimless.jp/blog/blog/archives/2506&#34;&gt;気軽にドキュメントを書く&lt;/a&gt;シリーズです。&lt;/p&gt;

&lt;p&gt;asciidocで書き、asciidoctor-pdfでさくっとPDFにするというソリューションがあるようなので試行錯誤を繰り返した結果、&lt;a href=&#34;https://gist.githubusercontent.com/kongou-ae/a3df7fb5aedf644acd72/raw/3227df201731519db0974813c1ff1f49dff19cc3/README.adoc&#34;&gt;この.adoc&lt;/a&gt;を&lt;a href=&#34;http://aimless.jp/blog/wp-content/uploads/2015/07/README.pdf&#34;&gt;このPDF&lt;/a&gt;に変換できるようになりました。&lt;/p&gt;

&lt;p&gt;使い方ではまった箇所をメモしておきます。&lt;/p&gt;

&lt;h2 id=&#34;インストール:0276447e54b8cc1adc3ebe7f7301ea42&#34;&gt;インストール&lt;/h2&gt;

&lt;p&gt;githubのREADMEに書いてある通り、gemでインストールするだけ。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ gem install --pre asciidoctor-pdf
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;デフォルトのテーマでpdfに変換する:0276447e54b8cc1adc3ebe7f7301ea42&#34;&gt;デフォルトのテーマでPDFに変換する&lt;/h2&gt;

&lt;p&gt;asciidoctor-pdfコマンドを利用します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ asciidoctor-pdf basic-example.adoc
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;自作テーマを利用してpdfに変換する:0276447e54b8cc1adc3ebe7f7301ea42&#34;&gt;自作テーマを利用してPDFに変換する&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc&#34;&gt;Asciidoctor PDF Theming Guide&lt;/a&gt;に記載されている通り、自分なりのテーマを作ることができます。テーマを自作するにあたっては、&lt;a href=&#34;https://github.com/asciidoctor/asciidoctor-pdf/blob/master/data/themes/default-theme.yml&#34;&gt;デフォルトテーマ&lt;/a&gt;の記載内容が参考になります。&lt;/p&gt;

&lt;p&gt;今回は&lt;a href=&#34;https://gist.github.com/kongou-ae/46291f86c53d959271a7&#34;&gt;basic-theme.yml&lt;/a&gt;を作りました。ファイルはresources/themes配下に配置されています。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ tree
.
|-- build.sh
|-- README.adoc
|-- README.pdf
|-- README.pdfmarks
`-- resources
    |-- fonts
    |-- images
    `-- themes
        |-- basic-theme.yml
        `-- header-img-10mm.png
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;自作テーマを利用するためには、asciidoctor-pdfコマンドの-aオプションで、pdf-stylesdirとpdf-styleを指定します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;asciidoctor-pdf -a pdf-stylesdir=/resources/themes -a pdf-style=basic README.adoc
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ページ番号を振る:0276447e54b8cc1adc3ebe7f7301ea42&#34;&gt;ページ番号を振る&lt;/h2&gt;

&lt;p&gt;ヘッダーとフッターにページ番号を振ることができます。今回は、.adocに:pagenums:を設定した上で、テーマファイルにページ番号の具体的なスタイルを記載します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ more README.adoc                                                                                   
= ほげほげサービス仕様書
ほげほげ株式会社 &amp;lt;doc.writer@example.jp&amp;gt;
v1.0, 2014-01-01
:toc:
:toc-title: 目次
:figure-caption: 図
:table-caption: 表
:toclevels: 2
:pagenums:
:sectnums:
:imagesdir: resources/images/


== はじめに

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;今回はフッターの真ん中にページ番号を表示してみましょう。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;footer:
  font_size: $base_font_size_small
  font_color: $base_font_color
  border_color: dddddd
  border_width: 0.25
  height: 25mm
  padding: [3mm,0,0,0]
  valign: top
  recto_content:
    center: &amp;#039;{page-number} / {page-count}&amp;#039;
  verso_content:
    center: &amp;#039;{page-number} / {page-count}&amp;#039;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;このようにフッターにページ番号が表示されます。今回はフッターにページ番号を付与しましたが、ヘッダーに付与することも可能です。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/07/asciidoctor_page_number.png&#34; alt=&#34;フッタ&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;ヘッダーやフッターに画像を追加する:0276447e54b8cc1adc3ebe7f7301ea42&#34;&gt;ヘッダーやフッターに画像を追加する&lt;/h2&gt;

&lt;p&gt;ヘッダーやフッターに画像を追加することが可能です。まずは。追加したい画像をテーマと同じディレクトリに配置します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ tree
.
|-- build.sh
|-- README.adoc
|-- README.pdf
|-- README.pdfmarks
`-- resources
    |-- fonts
    |-- images
    `-- themes
        |-- basic-theme.yml
        `-- header-img-10mm.png
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;そして、以下の様に設定します。今回はrecto_content_rightに画像を表示します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;header:
  font_size: $base_font_size_small
  font_color: $base_font_color
  border_color: dddddd
  border_width: 0.25
  height: 25mm
  padding: [0,0,3mm,0]
  valign: bottom
  image_valign: 50
  recto_content:
    left: &amp;#039;{document-title}&amp;#039;
    right: image:header-img-10mm.png[width=&#34;75&#34;]
  verso_content:
    left: &amp;#039;{document-title}&amp;#039;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ヘッダの右に画像が表示されました。ただしverso_content_rightにはimageを指定していないので、右ページには画像が出ますが、左ページには画像が出ません。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/07/asciidoctor_header_image.png&#34; alt=&#34;ヘッダーに画像&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;フォントを指定する:0276447e54b8cc1adc3ebe7f7301ea42&#34;&gt;フォントを指定する&lt;/h2&gt;

&lt;p&gt;デフォルトでは以下3種類のフォントが利用可能です。これら以外のフォントを利用することも可能です。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;NotoSerif&lt;/li&gt;
&lt;li&gt;Mplus1mn&lt;/li&gt;
&lt;li&gt;Mplus1pMultilingual&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Mplus1pMultilingual　にはboldがないので、migmix-1pを利用してみましょう。&lt;/p&gt;

&lt;p&gt;今回はresources/fonts配下にフォントを配置します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ tree                                                                                   
.
|-- build.sh
|-- README.adoc
|-- README.pdf
|-- README.pdfmarks
`-- resources
    |-- fonts
    |   `-- migmix-1p
    |       |-- ipag00303
    |       |   |-- IPA_Font_License_Agreement_v1.0.txt
    |       |   `-- Readme_ipag00303.txt
    |       |-- migmix-1p-bold.ttf
    |       |-- migmix-1p-regular.ttf
    |       `-- migmix-README.txt
    |-- images
    `-- themes
        |-- basic-theme.yml
        `-- header-img-10mm.png
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;テーマファイルでmigmixを使うことを宣言します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;font:
  catalog:
    migmix:
      normal: migmix-1p/migmix-1p-regular.ttf
      bold: migmix-1p/migmix-1p-bold.ttf
      italic: migmix-1p/migmix-1p-regular.ttf
      bold_italic: migmix-1p/migmix-1p-bold.ttf
  fallbacks:
    - migmix                                                                                                               
page:
  background_color: ffffff
  layout: portrait
  margin: [30mm, 30mm, 30mm, 30mm]
  size: A4
base:
  font_color: 000000
  font_family: migmix
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;asciidoctor-pdfコマンドの-aオプションでpdf-fontsdirを指定します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;asciidoctor-pdf -a pdf-stylesdir=/resources/themes -a pdf-style=basic -a pdf-fontsdir=/resources/fonts README.adoc
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;所感:0276447e54b8cc1adc3ebe7f7301ea42&#34;&gt;所感&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;PDFは綺麗に描画された。&lt;/li&gt;
&lt;li&gt;描画に至るまでの準備が簡単&lt;/li&gt;
&lt;li&gt;テーマのスタイルファイルは独自形式なので、CSSでの装飾と比べると自由度は狭い。

&lt;ul&gt;
&lt;li&gt;たとえば、現在の私の力では、テーブルの横幅を縮めることができない。[width=&amp;#8221;50&amp;#8243;]で表の横幅が50%になるはずなのだが、PDFに表示される表の横幅は100%になってしまいまう&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;必要最低限に装飾したPDFを作る分にはもってこいかも&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>VPC FLow Logsを継続的にElasticSearchに投入する</title>
      <link>http://aimless.jp/blog/archives/2617</link>
      <pubDate>Sun, 14 Jun 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2617</guid>
      <description>

&lt;p&gt;VPC FLow Logsのリリース直後から、クラメソさんの「&lt;a href=&#34;http://dev.classmethod.jp/cloud/aws/vpc-flow-logs-visualized-kibana4/&#34;&gt;VPC Flow LogsをElasticsearch + Kibana4で可視化する&lt;/a&gt;」と同じことを考えていました。週末に試行錯誤した結果をアウトプットします。&lt;/p&gt;

&lt;h2 id=&#34;ログの取り方:879fe74068b1e39f8423ed492442144f&#34;&gt;ログの取り方&lt;/h2&gt;

&lt;p&gt;　AWS SDK for Ruby を利用してClodWatch Logsを取得する方法は以下の様になります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# coding: utf-8

require &amp;#039;aws-sdk-core&amp;#039;

cloudwatchlogs = Aws::CloudWatchLogs::Client.new(region: region )

# cloudwatchlogs.get_log_eventsのオプションを定義
options = {
    log_group_name: log_group_name,
    log_stream_name: log_stream_name,
}

# ログを取得
resp = cloudwatchlogs.get_log_events(options)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　ただし、この方法でログを取得した場合、指定したlog_streamに格納されている大量のデータがレスポンスとして帰ってきます。デフォルトでは最大で1M Byte分のログが取得するようです。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://docs.aws.amazon.com/sdkforruby/api/Aws/CloudWatchLogs/Client.html#get_log_events-instance_method&#34;&gt;Class: Aws::CloudWatchLogs::Client&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;By default, this operation returns as much log events as can fit in a response size of 1MB, up to 10,000 log events.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;　したがって、このコードを継続的に実行すると、最初から1M byte分のログを繰り返し取得してしまいます。これでは意味がありません。実行時には、前回実行分以降のログを取得してほしい。これを実現する方法が、&lt;code&gt;get_log_events&lt;/code&gt;の&lt;code&gt;next_token&lt;/code&gt;オプションです。&lt;/p&gt;

&lt;h2 id=&#34;増分ログの取り方:879fe74068b1e39f8423ed492442144f&#34;&gt;増分ログの取り方&lt;/h2&gt;

&lt;p&gt;　&lt;code&gt;get_log_events&lt;/code&gt;のレスポンスには&lt;code&gt;next_forward_token&lt;/code&gt;と&lt;code&gt;next_backward_token&lt;/code&gt;が含まれています。これらは取得結果の次のページの位置を示しています。より新しいログの位置は名前的に&lt;code&gt;next_forward_token&lt;/code&gt;が保持しているっぽいです。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://docs.aws.amazon.com/sdkforruby/api/Aws/CloudWatchLogs/Client.html#get_log_events-instance_method&#34;&gt;Class: Aws::CloudWatchLogs::Client&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;resp.events #=&amp;gt; Array&lt;/p&gt;

&lt;p&gt;resp.events[0].timestamp #=&amp;gt; Integer&lt;/p&gt;

&lt;p&gt;resp.events[0].message #=&amp;gt; String&lt;/p&gt;

&lt;p&gt;resp.events[0].ingestion_time #=&amp;gt; Integer&lt;/p&gt;

&lt;p&gt;resp.next_forward_token #=&amp;gt; String&lt;/p&gt;

&lt;p&gt;resp.next_backward_token #=&amp;gt; String&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;　そこで、このtokenを利用して&lt;code&gt;get_log_events&lt;/code&gt;を実行するように、スクリプトを変更します。tokenの値は、fluentdっぽくstateファイルを作り、そこに書き込んでおきます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# coding: utf-8

require &amp;#039;aws-sdk-core&amp;#039;
require &amp;#039;fileutils&amp;#039;

region = &amp;#039;ap-northeast-1&amp;#039;
log_group_name = &amp;#039;VPCFLowLog&amp;#039;
log_stream_name = &amp;#039;eni-xxxxxxxx-all&amp;#039;
@state_file = Dir.pwd + &#34;/&#34; + log_group_name + &#34;.&#34; + log_stream_name + &#34;.state&#34;

# トークンをstateファイルに書き込む
def write_token(token)
    File.open(@state_file,&#34;w&#34;) do |file|
        file.puts(token)
    end
end

# トークンをstateファイルから読み込む
def read_token
    if File.exist?(@state_file) then
        return File.read(@state_file).chomp
    else
        return 
    end
end

cloudwatchlogs = Aws::CloudWatchLogs::Client.new(region: region )

# cloudwatchlogs.get_log_eventsのオプションを定義
options = {
    log_group_name: log_group_name,
    log_stream_name: log_stream_name,
}

# もしstateファイルから前回のtokenが取得できたら、そのtokenをオプションに追加
if read_token != nil  then
    options[:next_token] = read_token
end

# ログを取得
resp = cloudwatchlogs.get_log_events(options)

# 取得したログからtokenを保存
write_token(resp.next_forward_token)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;動作確認:879fe74068b1e39f8423ed492442144f&#34;&gt;動作確認&lt;/h2&gt;

&lt;p&gt;　ElasticSearchに投入済みのデータは以下の通りです。19:25:47までのログが格納されています。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/06/001.png&#34; alt=&#34;投入済みデータ&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　&lt;code&gt;next_token&lt;/code&gt;をつけて&lt;code&gt;get_log_events&lt;/code&gt;したデータをElasticSearchに投入します。投入時のログは以下の通りです。19:28:40のデータ以降がElasticSearchに投入されていることがわかります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2015-06-14 19:38:36 +0900: &amp;gt; {&#34;@timestamp&#34;:&#34;2015-06-14 19:28:40&#34;,&#34;version&#34;:&#34;2&#34;,&#34;account-id&#34;:&#34;250369693989&#34;,&#34;interface-id&#34;:&#34;eni-f5a92c83&#34;,&#34;srcaddr&#34;:&#34;157.7.235.92&#34;,&#34;dstaddr&#34;:&#34;10.175.10.97&#34;,&#34;srcport&#34;:&#34;123&#34;,&#34;dstport&#34;:&#34;123&#34;,&#34;protocol&#34;:&#34;17&#34;,&#34;packets&#34;:&#34;1&#34;,&#34;bytes&#34;:&#34;76&#34;,&#34;start&#34;:&#34;1434277720&#34;,&#34;end&#34;:&#34;1434277760&#34;,&#34;action&#34;:&#34;ACCEPT&#34;,&#34;log-status&#34;:&#34;OK&#34;}
2015-06-14 19:38:36 +0900: &amp;lt; {&#34;_index&#34;:&#34;aws&#34;,&#34;_type&#34;:&#34;vpcflowlog&#34;,&#34;_id&#34;:&#34;AU3xpkmyyQj6bWWoL4TA&#34;,&#34;_version&#34;:1,&#34;created&#34;:true}
2015-06-14 19:38:36 +0900: POST http://localhost:9200/aws/vpcflowlog [status:201, request:0.004s, query:n/a]
2015-06-14 19:38:36 +0900: &amp;gt; {&#34;@timestamp&#34;:&#34;2015-06-14 19:28:40&#34;,&#34;version&#34;:&#34;2&#34;,&#34;account-id&#34;:&#34;250369693989&#34;,&#34;interface-id&#34;:&#34;eni-f5a92c83&#34;,&#34;srcaddr&#34;:&#34;10.175.10.97&#34;,&#34;dstaddr&#34;:&#34;157.7.235.92&#34;,&#34;srcport&#34;:&#34;123&#34;,&#34;dstport&#34;:&#34;123&#34;,&#34;protocol&#34;:&#34;17&#34;,&#34;packets&#34;:&#34;1&#34;,&#34;bytes&#34;:&#34;76&#34;,&#34;start&#34;:&#34;1434277720&#34;,&#34;end&#34;:&#34;1434277760&#34;,&#34;action&#34;:&#34;ACCEPT&#34;,&#34;log-status&#34;:&#34;OK&#34;}
2015-06-14 19:38:36 +0900: &amp;lt; {&#34;_index&#34;:&#34;aws&#34;,&#34;_type&#34;:&#34;vpcflowlog&#34;,&#34;_id&#34;:&#34;AU3xpkm4yQj6bWWoL4TB&#34;,&#34;_version&#34;:1,&#34;created&#34;:true}
2015-06-14 19:38:36 +0900: POST http://localhost:9200/aws/vpcflowlog [status:201, request:0.003s, query:n/a]
2015-06-14 19:38:36 +0900: &amp;gt; {&#34;@timestamp&#34;:&#34;2015-06-14 19:28:40&#34;,&#34;version&#34;:&#34;2&#34;,&#34;account-id&#34;:&#34;250369693989&#34;,&#34;interface-id&#34;:&#34;eni-f5a92c83&#34;,&#34;srcaddr&#34;:&#34;162.255.180.213&#34;,&#34;dstaddr&#34;:&#34;10.175.10.97&#34;,&#34;srcport&#34;:&#34;1982&#34;,&#34;dstport&#34;:&#34;445&#34;,&#34;protocol&#34;:&#34;6&#34;,&#34;packets&#34;:&#34;2&#34;,&#34;bytes&#34;:&#34;96&#34;,&#34;start&#34;:&#34;1434277720&#34;,&#34;end&#34;:&#34;1434277760&#34;,&#34;action&#34;:&#34;REJECT&#34;,&#34;log-status&#34;:&#34;OK&#34;}
2015-06-14 19:38:36 +0900: &amp;lt; {&#34;_index&#34;:&#34;aws&#34;,&#34;_type&#34;:&#34;vpcflowlog&#34;,&#34;_id&#34;:&#34;AU3xpkm9yQj6bWWoL4TC&#34;,&#34;_version&#34;:1,&#34;created&#34;:true}
2015-06-14 19:38:36 +0900: POST http://localhost:9200/aws/vpcflowlog [status:201, request:0.003s, query:n/a]
（中略）
2015-06-14 19:38:36 +0900: &amp;gt; {&#34;@timestamp&#34;:&#34;2015-06-14 19:35:22&#34;,&#34;version&#34;:&#34;2&#34;,&#34;account-id&#34;:&#34;250369693989&#34;,&#34;interface-id&#34;:&#34;eni-f5a92c83&#34;,&#34;srcaddr&#34;:&#34;10.175.10.97&#34;,&#34;dstaddr&#34;:&#34;46.17.98.184&#34;,&#34;srcport&#34;:&#34;22&#34;,&#34;dstport&#34;:&#34;27530&#34;,&#34;protocol&#34;:&#34;6&#34;,&#34;packets&#34;:&#34;1&#34;,&#34;bytes&#34;:&#34;48&#34;,&#34;start&#34;:&#34;1434278122&#34;,&#34;end&#34;:&#34;1434278181&#34;,&#34;action&#34;:&#34;ACCEPT&#34;,&#34;log-status&#34;:&#34;OK&#34;}
2015-06-14 19:38:36 +0900: &amp;lt; {&#34;_index&#34;:&#34;aws&#34;,&#34;_type&#34;:&#34;vpcflowlog&#34;,&#34;_id&#34;:&#34;AU3xpkoQyQj6bWWoL4TY&#34;,&#34;_version&#34;:1,&#34;created&#34;:true}
2015-06-14 19:38:36 +0900: POST http://localhost:9200/aws/vpcflowlog [status:201, request:0.002s, query:n/a]
2015-06-14 19:38:36 +0900: &amp;gt; {&#34;@timestamp&#34;:&#34;2015-06-14 19:36:55&#34;,&#34;version&#34;:&#34;2&#34;,&#34;account-id&#34;:&#34;250369693989&#34;,&#34;interface-id&#34;:&#34;eni-f5a92c83&#34;,&#34;srcaddr&#34;:&#34;199.203.59.117&#34;,&#34;dstaddr&#34;:&#34;10.175.10.97&#34;,&#34;srcport&#34;:&#34;26600&#34;,&#34;dstport&#34;:&#34;80&#34;,&#34;protocol&#34;:&#34;6&#34;,&#34;packets&#34;:&#34;1&#34;,&#34;bytes&#34;:&#34;48&#34;,&#34;start&#34;:&#34;1434278215&#34;,&#34;end&#34;:&#34;1434278241&#34;,&#34;action&#34;:&#34;REJECT&#34;,&#34;log-status&#34;:&#34;OK&#34;}
2015-06-14 19:38:36 +0900: &amp;lt; {&#34;_index&#34;:&#34;aws&#34;,&#34;_type&#34;:&#34;vpcflowlog&#34;,&#34;_id&#34;:&#34;AU3xpkoTyQj6bWWoL4TZ&#34;,&#34;_version&#34;:1,&#34;created&#34;:true}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　投入後のデータ一覧は以下の通りです。19:25:47以前のログが重複登録されることなく、19:25:47以降のログが増えました！！！&lt;/p&gt;

&lt;p&gt;![投入済みデータ][4]&lt;/p&gt;

&lt;p&gt;　それっぽく動いたスクリプトは以下の通りです。cronで回してみてみようと思います。&lt;/p&gt;

&lt;p&gt;　&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# coding: utf-8

require &#34;json&#34;
require &amp;#039;aws-sdk-core&amp;#039;
require &amp;#039;elasticsearch&amp;#039;
require &amp;#039;fileutils&amp;#039;

region = &amp;#039;ap-northeast-1&amp;#039;
log_group_name = &amp;#039;VPCFLowLog&amp;#039;
log_stream_name = &amp;#039;eni-xxxxxxxx-all&amp;#039;
@state_file = Dir.pwd + &#34;/&#34; + log_group_name + &#34;.&#34; + log_stream_name + &#34;.state&#34;

# トークンをstateファイルに書き込む
def write_token(token)
    File.open(@state_file,&#34;w&#34;) do |file|
        file.puts(token)
    end
end

# トークンをstateファイルから読み込む
def read_token
    if File.exist?(@state_file) then
        return File.read(@state_file).chomp
    else
        return 
    end
end

cloudwatchlogs = Aws::CloudWatchLogs::Client.new(region: region )

# cloudwatchlogs.get_log_eventsのオプションを定義
options = {
    log_group_name: log_group_name,
    log_stream_name: log_stream_name,
}

# もしstateファイルから前回のtokenが取得できたら、そのtokenをオプションに追加
if read_token != nil  then
    options[:next_token] = read_token
end

# ログを取得
resp = cloudwatchlogs.get_log_events(options)

# 取得したログからtokenを保存
write_token(resp.next_forward_token)

hash = {}
message_elements = Array.new()

message_field = [
    &#34;version&#34;,
    &#34;account-id&#34;,
    &#34;interface-id&#34;,
    &#34;srcaddr&#34;,
    &#34;dstaddr&#34;,
    &#34;srcport&#34;,
    &#34;dstport&#34;,
    &#34;protocol&#34;,
    &#34;packets&#34;,
    &#34;bytes&#34;,
    &#34;start&#34;,
    &#34;end&#34;,
    &#34;action&#34;,
    &#34;log-status&#34;]

resp.events.each {|event|

    hash[&#34;@timestamp&#34;] = Time.at(event.timestamp/1000.0).strftime(&amp;#039;%Y-%m-%d %H:%M:%S&amp;#039;)
    message_elements = event.message.split(&#34; &#34;)
    message_elements.each.with_index(0)  {|element,i|
        hash[message_field[i]] = element
    }

    # BytesとPacketsをInteger型にすると、NODATAの時の-が型エラーになるので、捨てる
    if hash[&#34;log-status&#34;] != &#34;NODATA&#34; then
        client = Elasticsearch::Client.new(hosts: &#34;localhost:9200&#34;,log: true)
        client.index(index:&#34;aws&#34;, type:&#34;vpcflowlog&#34;, body:hash.to_json)
    end
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;[4]: &lt;a href=&#34;http://aimless.jp/blog/wp-content/uploads/2015/06/002.png&#34;&gt;http://aimless.jp/blog/wp-content/uploads/2015/06/002.png&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>PrometheusでAmazon Linuxのメトリクスを収集する</title>
      <link>http://aimless.jp/blog/archives/2595</link>
      <pubDate>Sun, 10 May 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2595</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://aimless.jp/blog/blog/archives/2586&#34;&gt;Amazon LinuxでPrometheusを動かしてみた&lt;/a&gt;で動いたPrometheusを利用して、サーバのメトリクスを収集します。今回はPrometheusが稼働しているAmazon Linuxのメトリクスを収集します。&lt;/p&gt;

&lt;h2 id=&#34;node-exporterを稼働させる:e67d1193b4ff96687e3431437834ddb9&#34;&gt;node_exporterを稼働させる&lt;/h2&gt;

&lt;p&gt;　メトリクスを収集したいサーバでnode_exporterというバイナリを起動します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;yum install git hg gcc golang
git clone https://github.com/prometheus/node_exporter.git
make
./node_exporter &amp;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　node_exporterは、Prometheusサーバが読み取れるデータを生成し9100ポートで公開してくれます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[ec2-user@ip-10-175-10-126 ~]$  wget http://localhost:9100/metrics
[ec2-user@ip-10-175-10-126 ~]$ more metrics 
# HELP go_gc_duration_seconds A summary of the GC invocation durations.
# TYPE go_gc_duration_seconds summary
go_gc_duration_seconds{quantile=&#34;0&#34;} 8.5685e-05
go_gc_duration_seconds{quantile=&#34;0.25&#34;} 0.0006615610000000001
go_gc_duration_seconds{quantile=&#34;0.5&#34;} 0.00068378
go_gc_duration_seconds{quantile=&#34;0.75&#34;} 0.000708493
go_gc_duration_seconds{quantile=&#34;1&#34;} 0.017944932
go_gc_duration_seconds_sum 0.155032352
go_gc_duration_seconds_count 205
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　なお、node_exporterはWindowsをサポートしないようです。（&lt;a href=&#34;https://github.com/prometheus/node_exporter/issues/65&#34;&gt;Windows support&lt;/a&gt;）&lt;/p&gt;

&lt;p&gt;　node_exporterと同じように、定期的に自サーバのメトリクスを取得し、ファイルに書き込み、httpで公開できる仕組みを作れば、windowsでもメトリクスを収集できる気がします。&lt;/p&gt;

&lt;h2 id=&#34;prometheusにnodeを登録する:e67d1193b4ff96687e3431437834ddb9&#34;&gt;Prometheusにnodeを登録する&lt;/h2&gt;

&lt;p&gt;　Prometheusサーバに、node_exporterが生成するデータを登録します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[ec2-user@ip-10-175-10-126 ~]$ cat prometheus.conf  
（中略）
job: {
  name: &#34;node&#34;
  scrape_interval: &#34;5s&#34;
  target_group: {
    target: &#34;http://localhost:9100/metrics&#34;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;prometheusでメトリクスを確認する:e67d1193b4ff96687e3431437834ddb9&#34;&gt;Prometheusでメトリクスを確認する&lt;/h2&gt;

&lt;p&gt;　Prometheusサーバを再起動すると、コンソールにNodeが追加され、メトリクスを収集している対象の一覧が表示されます。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/05/primetheus_node_summary.png&#34; alt=&#34;primetheus_node_summary&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　対象のノードをクリックすると、CPUとメモリ、ディスクのグラフが描画されています。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/05/prometheus_node_detail.png&#34; alt=&#34;prometheus_node_detail&#34; /&gt;&lt;/p&gt;

&lt;p&gt;　Graphタブを利用することで、取得したメトリクスのグラフを描画することが可能です。データの抽出は&lt;a href=&#34;http://prometheus.io/docs/querying/basics/#querying-prometheus&#34;&gt;QUERY LANGUAGE&lt;/a&gt;を利用する必要があります。&lt;/p&gt;

&lt;p&gt;![prometheus_node_metric_graph][6]&lt;/p&gt;

&lt;p&gt;[6]: &lt;a href=&#34;http://aimless.jp/blog/wp-content/uploads/2015/05/prometheus_node_metric_graph.png&#34;&gt;http://aimless.jp/blog/wp-content/uploads/2015/05/prometheus_node_metric_graph.png&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Amazon LinuxでPrometheusを動かしてみた</title>
      <link>http://aimless.jp/blog/archives/2586</link>
      <pubDate>Sat, 09 May 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2586</guid>
      <description>&lt;p&gt;Prometheusを試してみようと思いインストール方法を調べた結果、バイナリファイルが公開されていることがわかりました。バイナリファイルを利用すると、さくっと動いたのでメモしておきます。必要な手順は以下の通りです。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;tarballのダウンロードと解凍&lt;/li&gt;
&lt;li&gt;prometheus.confの作成（&lt;a href=&#34;http://prometheus.io/docs/introduction/getting_started/#configuring-prometheus-to-monitor-itself&#34;&gt;GETTING STARTEDの内容をままコピペ&lt;/a&gt;）&lt;/li&gt;
&lt;li&gt;prometheusの起動&lt;/li&gt;
&lt;li&gt;HTTPで9090ポートにアクセス&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;[ec2-user@ip-10-175-10-126 ~]$ wget https://github.com/prometheus/prometheus/releases/download/0.13.2/prometheus-0.13.2.linux-amd64.tar.gz
--2015-05-09 12:07:12--  https://github.com/prometheus/prometheus/releases/download/0.13.2/prometheus-0.13.2.linux-amd64.tar.gz
Resolving github.com (github.com)... 192.30.252.131
Connecting to github.com (github.com)|192.30.252.131|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://s3.amazonaws.com/github-cloud/releases/6838921/b318dbf0-f3e7-11e4-8be7-d3716d1f32e5.gz?response-content-disposition=attachment%3B%20filename%3Dprometheus-0.13.2.linux-amd64.tar.gz&amp;response-content-type=application/octet-stream&amp;AWSAccessKeyId=AKIAISTNZFOVBIJMK3TQ&amp;Expires=1431173292&amp;Signature=J5eC%2F4n8UDnReRDLitzGezZLj88%3D [following]
--2015-05-09 12:07:13--  https://s3.amazonaws.com/github-cloud/releases/6838921/b318dbf0-f3e7-11e4-8be7-d3716d1f32e5.gz?response-content-disposition=attachment%3B%20filename%3Dprometheus-0.13.2.linux-amd64.tar.gz&amp;response-content-type=application/octet-stream&amp;AWSAccessKeyId=AKIAISTNZFOVBIJMK3TQ&amp;Expires=1431173292&amp;Signature=J5eC%2F4n8UDnReRDLitzGezZLj88%3D
Resolving s3.amazonaws.com (s3.amazonaws.com)... 54.231.244.8
Connecting to s3.amazonaws.com (s3.amazonaws.com)|54.231.244.8|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 6796769 (6.5M) [application/octet-stream]
Saving to: ‘prometheus-0.13.2.linux-amd64.tar.gz’

prometheus-0.13.2.linux-am 100%[==========================================&amp;gt;]   6.48M  1.89MB/s   in 3.4s   

2015-05-09 12:07:17 (1.89 MB/s) - ‘prometheus-0.13.2.linux-amd64.tar.gz’ saved [6796769/6796769]

[ec2-user@ip-10-175-10-126 ~]$ tar xzvf prometheus-0.13.2.linux-amd64.tar.gz 
prometheus
tools/rule_checker/rule_checker
consoles/
consoles/haproxy.html
consoles/cassandra.html
consoles/haproxy-frontend.html
consoles/index.html.example
consoles/node-overview.html
consoles/federation_template_example.txt
consoles/aws_elb.html
consoles/aws_redshift-cluster.html
consoles/node-cpu.html
consoles/index.html
consoles/node-disk.html
consoles/haproxy-backends.html
consoles/aws_redshift.html
consoles/cloudwatch.html
consoles/aws_elasticache.html
consoles/haproxy-backend.html
consoles/node.html
consoles/haproxy-frontends.html
console_libraries/
console_libraries/prom.lib
console_libraries/menu.lib
[ec2-user@ip-10-175-10-126 ~]$ ls
console_libraries  consoles  prometheus  prometheus-0.13.2.linux-amd64.tar.gz  tools

[ec2-user@ip-10-175-10-126 ~]$ touch prometheus.conf                                                        
[ec2-user@ip-10-175-10-126 ~]$ vim prometheus.conf 
[ec2-user@ip-10-175-10-126 ~]$ ./prometheus 
prometheus, version 0.13.2 (branch: HEAD, revision: f4d90a1)
  build user:       fish@localhost
  build date:       20150506-12:01:47
  go version:       1.4.2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;![GUI][2]&lt;/p&gt;

&lt;p&gt;[2]: &lt;a href=&#34;http://aimless.jp/blog/wp-content/uploads/2015/05/Prometheus_GUI.png&#34;&gt;http://aimless.jp/blog/wp-content/uploads/2015/05/Prometheus_GUI.png&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Let’s Chatでhubotを動かす</title>
      <link>http://aimless.jp/blog/archives/2570</link>
      <pubDate>Sat, 02 May 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2570</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://sdelements.github.io/lets-chat/&#34;&gt;Let&amp;#8217;s Chat&lt;/a&gt;でhubotを動かしてみました。&lt;/p&gt;

&lt;h2 id=&#34;let-8217-s-chatのインストール:cfa74896d771b319eb38f92c098ab1f2&#34;&gt;Let&amp;#8217;s Chatのインストール&lt;/h2&gt;

&lt;p&gt;　nodejsとpythonはインストール済みなので、mongodbのみyumでインストールします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo yum install mongodb
sudo yum install mongodb-server.x86_64
sudo systemctl start mongod.service
git clone https://github.com/sdelements/lets-chat.git
cd lets-chat
npm install
npm start
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　デフォルトだと5000番でリッスンします。FQDNやポート番号を含む各種パラメータは&lt;code&gt;settings.yml&lt;/code&gt;で変更可能です。今回は、Let&amp;#8217;s Chatはデフォルト設定のままとし、前段のnginxでバーチャルホスト+80番のアクセスを受けて、Let&amp;#8217;s Chatの5000番にProxyPassしています。&lt;/p&gt;

&lt;h2 id=&#34;hubot用アカウントの作成:cfa74896d771b319eb38f92c098ab1f2&#34;&gt;hubot用アカウントの作成&lt;/h2&gt;

&lt;p&gt;　Let&amp;#8217;s Chatにhubot用のアカウントを作成します。また作成したアカウントのAuth Tokenを取得します。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/05/SnapCrab_NoName_2015-5-2_23-16-54_No-00.png&#34; alt=&#34;Token&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;hubotのインストール:cfa74896d771b319eb38f92c098ab1f2&#34;&gt;hubotのインストール&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;sudo  npm install -g yo generator-hubot
mkdir myhubot
cd myhubot
yo hubot
npm install hubot-lets-chat --save
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;hubot起動スクリプトの作成:cfa74896d771b319eb38f92c098ab1f2&#34;&gt;hubot起動スクリプトの作成&lt;/h2&gt;

&lt;p&gt;　&lt;code&gt;HUBOT_LCB_TOKEN&lt;/code&gt;の項目に、Let&amp;#8217;s Chat上で取得したhubotアカウントのAuth Tokenを記載します。また&lt;code&gt;HUBOT_LCB_ROOMS&lt;/code&gt;にはhubotを常駐させたいRoomの識別子（URLに含まれる値）を入力します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;myhubot]$ cat run_hubot.sh
export HUBOT_LCB_TOKEN=TOKEN_OF_YOUR_HUBOT_ACCOUNT
export HUBOT_LCB_ROOMS=553db2dcf62762863672ea19
bin/hubot -a lets-chat
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;hubotの起動-動作確認:cfa74896d771b319eb38f92c098ab1f2&#34;&gt;hubotの起動＋動作確認&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;myhubot]$ ./run_hubot.sh                                 
connected
[Sun May 03 2015 00:01:55 GMT+0900 (JST)] ERROR hubot-heroku-alive included, but missing HUBOT_HEROKU_KEEPALIVE_URL. `heroku config:set HUBOT_HEROKU_KEEPALIVE_URL=$(heroku apps:info -s  | grep web_url | cut -d= -f2)`
[Sun May 03 2015 00:01:55 GMT+0900 (JST)] INFO Using default redis on localhost:6379
Joined test
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　&lt;code&gt;test&lt;/code&gt;というルームにhubotがログインしました。hubotを停止すると退室します。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aimless.jp/blog/wp-content/uploads/2015/05/SnapCrab_NoName_2015-5-2_23-11-30_No-00.png&#34; alt=&#34;add room&#34; /&gt;&lt;/p&gt;

&lt;p&gt;@つきでhubotに&lt;code&gt;ping&lt;/code&gt;や&lt;code&gt;date&lt;/code&gt;すると、ちゃんと答えます。&lt;/p&gt;

&lt;p&gt;![hubot response][4]&lt;/p&gt;

&lt;p&gt;[4]: &lt;a href=&#34;http://aimless.jp/blog/wp-content/uploads/2015/05/SnapCrab_NoName_2015-5-2_23-12-0_No-00.png&#34;&gt;http://aimless.jp/blog/wp-content/uploads/2015/05/SnapCrab_NoName_2015-5-2_23-12-0_No-00.png&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>aws-sdk-goでELB配下のインスタンスを取得する</title>
      <link>http://aimless.jp/blog/archives/2546</link>
      <pubDate>Sat, 11 Apr 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aimless.jp/blog/archives/2546</guid>
      <description>&lt;p&gt;諸事情によりAWS製ツールをインストールできないWindows端末でAWSのAPIを叩く必要があり、手法を検討しました。あーだこーだと悩んだ結果、別の端末で作成したバイナリファイルを実行することを閃きました。こんな時のためのaws-sdk-goです。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;package main

import (
    &#34;fmt&#34;
    &#34;github.com/awslabs/aws-sdk-go/aws&#34;
    &#34;github.com/awslabs/aws-sdk-go/service/elb&#34;
    &#34;sort&#34;
    &#34;strings&#34;
)

func main() {
    accessKey := &#34;YOUR_ACCESS_KEY&#34;
    secretKey := &#34;YOUR_AECRET_KEY&#34;
    region := &#34;ap-northeast-1&#34;
    elbName := &#34;YOUR_ELB_NAME&#34;
    var inserviceInstances []string

    cred := aws.DetectCreds(accessKey, secretKey, &#34;&#34;)
    elbSvc := elb.New(&amp;aws.Config{Credentials: cred, Region: region})

    param := &amp;elb.DescribeInstanceHealthInput{
        LoadBalancerName: aws.String(elbName),
    }

    res, err := elbSvc.DescribeInstanceHealth(param)

    if err != nil {
        panic(err)
    }

    for i := range res.InstanceStates {
        result := *res.InstanceStates[i].InstanceID + &#34;:&#34; + *res.InstanceStates[i].State
        inserviceInstances = append(inserviceInstances, result)
    }

    sort.Strings(inserviceInstances)
    fmt.Print(strings.Join(inserviceInstances, &#34;,&#34;))
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　このスクリプトを実行すると、対象ELB配下のインスタンスとその状態が表示されます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;go run main.go
i-xxxxxxxx:OutOfService,i-xxxxxxxx:OutOfService
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　コンパイルしたバイナリファイルを実行しても同じ結果になります。このバイナリを問題のWindows端末で実行すれば問題は解決です。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;go build main.go

&amp;gt;main.exe
i-xxxxxxxx:OutOfService,i-xxxxxxxx:OutOfService
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>